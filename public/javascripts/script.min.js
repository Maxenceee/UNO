/*!






 __  __                                                  ____                             
|  \/  |   __ _  __  __   ___   _ __     ___    ___     / ___|   __ _   _ __ ___     __ _ 
| |\/| |  / _` | \ \/ /  / _ \ | '_ \   / __|  / _ \   | |  _   / _` | | '_ ` _ \   / _` |
| |  | | | (_| |  >  <  |  __/ | | | | | (__  |  __/   | |_| | | (_| | | | | | | | | (_| |
|_|  |_|  \__,_| /_/\_\  \___| |_| |_|  \___|  \___|    \____|  \__,_| |_| |_| |_|  \__,_|
    





*/
/*!
*   @license Â© Copyright 2022, All rights reserved.
*   @author: Maxence Gama, maxence.gama@gmail.com, @maxencegama
*/
var g,aa=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}},ba=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}},ca="function"==typeof Object.create?Object.create:function(a){var b=function(){};return b.prototype=a,new b},da;if("function"==typeof Object.setPrototypeOf)da=Object.setPrototypeOf;else{var ea;a:{var fa={Zd:!0},ha={};try{ha.__proto__=fa,ea=ha.Zd;break a}catch(a){}ea=!1}da=ea?function(a,b){if(a.__proto__=b,a.__proto__!==b)throw new TypeError(a+" is not extensible");return a}:null}var ia=da,ca="function"==typeof Object.create?Object.create:function(a){var b=function(){};return b.prototype=a,new b},Bf=function(){return 589824<window.innerHeight*window.innerWidth},Me=function(a,b,c){return Le(document,arguments)},Le=function(a,b){var c=String(b[0]),d=b[1],e=b[2]||null;return c=["svg","path","circle","text"].includes(c.toLowerCase())?a.createElementNS("http://www.w3.org/2000/svg",c):a.createElement(c),e&&e.in&&(c.innerHTML=e.in),e&&e.style&&(c.style=e.style),b&&(d&&"object"!=typeof e&&!je(d)?Na(c,d,e):e&&e.type?c.setAttribute(e.type,d):d&&(c.className=d)),c},Na=function(b,c,d){function e(h,i){b.setAttribute(h,i)}for(var i=0;i<Math.min(c.length,d.length);i++)e(c[i],d[i])},Mc=function(a,b){a.classList.add(b)},Mr=function(a,b){a.classList.remove(b)},jl=function(a){return"string"==typeof a},Ms=function(a,b,c){return jl(b)?a.setAttribute(b,void 0!==c?c:""):Na(a,b,c),a},Md=function(a,b){return b instanceof Node?a.appendChild(b):dj(a,b),a},Mg=function(a,b){return a.getElementsByClassName(b)},Mqa=function(a,b){return a.querySelectorAll(b)},Mq=function(a,b){return a.querySelector(b)},dj=function(a,b){for(var i=0;i<b.length;i++)a.appendChild(b[i])},ba=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):{next:aa(a)}},oa=function(a){a.Ec=void 0,a.ja=function(){return a.Ec?a.Ec:a.Ec=new a}},t=function(a,b){function c(){}c.prototype=b.prototype,a.Z=b.prototype,a.prototype=new c,a.prototype.constructor=a,a.bf=function(d,e,f){for(var h=Array(arguments.length-2),k=2;k<arguments.length;k++)h[k-2]=arguments[k];return b.prototype[e].apply(d,h)}},ie=function(a,b){this.vb=[],this.Dc=[];for(var c=(b=ba(b)).next();!c.done;c=b.next()){var d=c.value;c=new qd(a+d.filename),d=d.size,this.vb.push(c),this.Dc.push(d)}},je=function(a){return ma(a)?a:a[0]};(g=ie.prototype).xb=function(){return this.vb[je(void 0)].xb()},g.preload=function(a,b){var c=this.vb[je(a)];return new Promise((function(d){c.Tb?d():c.Ad.push(d),c.preload()})).then((function(){return b&&b()}))},g.xb=function(){return this.vb[je(void 0)].xb()},g.Ta=function(a){return a[3]},g.tb=function(a){return a[4]},g.Ac=function(a){return{width:a[3],height:a[4]}},g.drawImage=function(a,b,c,d,e,f,h,k,p,q){var u=b[1],E=b[2],D=b[3],M=b[4];if(null==e){var Q=u,R=E,ua=D,va=M;e=D,f=M}else null==h?(Q=u,R=E,ua=D,va=M):(Q=u+c,R=E+d,ua=e,va=f,c=h,d=k,e=p,f=q);if(Q<u&&(q=u-Q,Q=u,ua-=q,c+=q,e-=q),R<E&&(q=E-R,R=E,va-=q,d+=q,f-=q),Q+ua>u+D&&(ua-=u=Q+ua-(u+D),e-=u),R+va>E+M&&(va-=E=R+va-(E+M),f-=E),!(b=this.vb[je(b)]).xb())throw Error("Spritesheet is not loaded, can't draw.");0<ua&&0<va&&a.drawImage(b.image,Q,R,ua,va,c,d,e,f)},g.ta=function(a,b,c,d){var e=void 0===e?1:e,f=void 0!==f&&f,h=void 0!==h&&h,k=void 0!==k&&k,p=this.Ta(a),q=this.tb(a);b.save(),b.translate(c,d),b.scale(h?-e:e,k?-e:e),this.drawImage(b,a,0,0,p,q,-p*(f?.5:h?1:0),-q*(f?.5:k?1:0),p,q),b.restore()};var qd=function(a){od.call(this,a),this.image=new Image},od=function(a){this.gd=a,this.Tb=!1,this.Ad=[]};od.prototype.xb=function(){return this.Tb},pd=function(a){if(!a.Tb){a.Tb=!0;for(var b=0,c;c=a.Ad[b];b++)c()}},t(qd,od),qd.prototype.preload=function(){if(!this.image.src){var a=this;this.image.onload=function(){pd(a)},this.image.src=this.gd,(this.image.complete||"complete"==this.image.readyState)&&pd(this)}},Pe=function(a,b){a.appendChild(b)},n=function(a){return void 0!==a},r=function(a){return"string"==typeof a},ma=function(a){return"number"==typeof a},Fe=function(a,b){return r(b)?a.getElementById(b):b},Fa=function(a,b){return r(b)?a.getElementsByClassName(b)[0]:b},l=function(a,b){if(a.prototype=ca(b.prototype),a.prototype.constructor=a,ia)ia(a,b);else for(var c in b)if("prototype"!=c)if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(b,c);d&&Object.defineProperty(a,c,d)}else a[c]=b[c];a.Z=b.prototype},jf=function(a,b,c){if(b instanceof Be)c=b.height,b=b.width;else if(null==c)throw Error("missing height argument");a.style.width=gf(b,!0),a.style.height=gf(c,!0)},gf=function(a,b){return"number"==typeof a&&(a=(b?Math.round(a):a)+"px"),a},hf=function(a,b,c){if(b instanceof Ae){var d=b.x;b=b.y}else d=b,b=c;a.style.left=gf(d,!1),a.style.top=gf(b,!1)},La=function(a,b){var c=String(b[0]),d=b[1];return c=a.createElement(c),d&&(r(d)?c.className=d:c.className=d.join(" ")),2<b.length&&Ne(a,c,b,2),c},Ne=function(a,b,c,d){function e(h){h&&b.appendChild(r(h)?a.createTextNode(h):h)}for(;d<c.length;d++){var f;e(c[d])}},uf=function(){return me.ja().Ac(ne)};var me=function(){ie.call(this,"/",le)};l(me,ie);var le=[{filename:"images/UNO_cards.svg",size:[3360,893]}],ne=[0,0,0,240,360],oe=[0,0,1440,240,360],pe=[0,240,1440,240,360],qe=[0,0,2160,240,360];oa(me);var Cf=function(a,b,e){var c=me.ja(),d=Me("CANVAS",e||"card-canvas");return Pe(Fe(document,a),d),d.width=b[3],d.height=b[4],c.drawImage(d.getContext("2d"),b,0,0),d},S=Math.round(uf().width*(Bf()?.55:.33)),T=Math.round(uf().height*(Bf()?.55:.33)),L=500,Qf=function(a){this.wa=a,this.rb=a.getContext("2d"),this.Kd=me.ja(),this.width=a.width,this.height=a.height};Qf.prototype.clear=function(){this.rb.clearRect(0,0,this.wa.width,this.wa.height)},Qf.prototype.ta=function(a,b,c){this.Kd.ta(a,this.rb,b,c)};var O=function(a,b,c,d){this.left=a,this.top=b,this.width=c,this.height=d};(g=O.prototype).clone=function(){return new O(this.left,this.top,this.width,this.height)},g.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"},g.contains=function(a){return this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height},g.inter=function(a){return(a.left<=this.left&&a.left+a.width>=this.left||a.left>=this.left&&a.left<=this.left+this.width)&&(a.top<=this.top&&a.top+a.height>=this.top||a.top>=this.top&&a.top<=this.top+this.height)},g.Ac=function(){return new Be(this.width,this.height)},g.ceil=function(){return this.left=Math.ceil(this.left),this.top=Math.ceil(this.top),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},g.floor=function(){return this.left=Math.floor(this.left),this.top=Math.floor(this.top),this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},g.round=function(){return this.left=Math.round(this.left),this.top=Math.round(this.top),this.width=Math.round(this.width),this.height=Math.round(this.height),this};var Be=function(a,b){this.width=a,this.height=b};(g=Be.prototype).clone=function(){return new Be(this.width,this.height)},g.toString=function(){return"("+this.width+" x "+this.height+")"},g.aspectRatio=function(){return this.width/this.height},g.ceil=function(){return this.width=Math.ceil(this.width),this.height=Math.ceil(this.height),this},g.floor=function(){return this.width=Math.floor(this.width),this.height=Math.floor(this.height),this},g.round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},g.scale=function(a,b){return b=ma(b)?b:a,this.width*=a,this.height*=b,this};var mergeProto=function(a,b){return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(a,b)},moveEffect=function(){console.log()};Jf=function(a,b){var c=a.bc;return a=isNaN(c.left)?null:c.left,c=isNaN(c.width)?0:c.width,Math.min(null!=a?a+c:1/0,Math.max(null!=a?a:-1/0,b))},Kf=function(a,b){var c=a.bc;return a=isNaN(c.top)?null:c.top,c=isNaN(c.height)?0:c.height,Math.min(null!=a?a+c:1/0,Math.max(null!=a?a:-1/0,b))},Lf=function(a,b){var c;return a-(a-b)};var CallBack=function(){};CallBack.prototype.on=function(t,e){this.listeners=this.listeners||{},this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},CallBack.prototype.emit=function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=this.listeners[t];i&&i.length&&i.forEach((function(t){return t.apply(void 0,n)}))};var Events=function(a,c){this.event=null,this.parent=null,a&&this.dispatchEvent(...arguments)},ce=Events.prototype;ce.dispatchEvent=function(a,b,c,e){let d;if(this.event)throw Error("Event already exist");this.parent=b,this.event=c,this.name=a;for(var i=0;i<a.length;i++)b.addEventListener(a[i],this.event,e||{passive:!0})},ce.removeEvent=function(){for(var i=0;i<this.name.length;i++)this.parent.removeEventListener(this.name[i],this.event)};var jdf=function(a,b,c,d,e){a.push(new Events(b,c,d,e))},jdg=function(a,b){for(var i=0;i<a.length;i++){let d=a[i];jdf(b,d[0],d[1],d[2],d[3])}},mdg=function(a){if(a)for(var i=0;i<a.length;i++){let d;a[i].removeEvent()}},dkf=function(a){return"object"==typeof a},setTransformProprety=function(a,b,c){let l="";void 0!==c&&(l+=" scale("+c+") "),l+="rotate("+b+"deg)",a.style.transform=l},genRandomId=function(a){a.id=makeId(5)+"-"+makeId(5)+"-"+makeId(5)},makeId=function(l){for(var res="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<l;i++)res+=characters.charAt(Math.floor(Math.random()*characters.length));return res},Card=function(a,b,c){this.left=a.left||null,this.top=a.top||null,this.card=this.I("DIV",a&&r(a)||b||"card",this.I("CANVAS","card-canvas")),a&&dkf(a)&&this.moveTo(),this.width=c?c.width:S,this.height=c?c.height:T,genRandomId(this)};mergeProto(Card,CallBack);var c=Card.prototype;c.drawcard=function(a,b,c){let patern=this.patern?this.patern:ma(b)?[0,240*b,360*c,240,360]:b;return this.wa=this.zc("card-canvas",this.card),this.wa.width=uf().width,this.wa.height=uf().height,this.d=new Qf(this.wa),jf(this.card,this.width,this.height),a.appendChild(this.card),this.d.ta(patern,0,0),this.card.style.transition="left "+L+"ms ease, top "+L+"ms ease, transform "+L+"ms ease",this},c.createCardPatern=function(a,b){return this.patern=[0,240*(a.x+(b||0)),360*a.y,240,360],this},c.redrawcard=function(b,c){let patern=this.patern?this.patern:ma(b)?[0,240*b,360*c,240,360]:b;return this.d.ta(patern,0,0),this},c.moveTo=function(a,b){return a&&(this.left=a.left,this.top=a.top),this.card.style.left=this.left+"px",this.card.style.top=this.top+"px",void 0!==b&&(this.card.style.transform="rotate("+b+"deg)"),this},c.I=function(a,b,c){return La(document,arguments)},c.canv=function(){return this.card},c.zc=function(a,b){var c=b||document;return c.getElementsByClassName&&(a=c.getElementsByClassName(a)[0]),a||null},c.placeZ=function(a){return this.card.style.zIndex=a,this},c.resize=function(a,b){return this.width=a,this.height=b,this.card.classList.add("grow-transition"),jf(this.card,this.width,this.height),this},c.flip=function(a,b,c,d){let n=this.I("CANVAS","card-canvas backface"),l=codeToCoord(a),m=[0,240*(l.x+(hjr(b)||0)),360*l.y,240,360],p=new Qf(n);n.width=uf().width,n.height=uf().height,this.card.appendChild(n),p.ta(m,0,0),window.setTimeout(()=>{this.zc("gamepack").style.opacity=0,this.card.style.transform+="rotateY(180deg)",window.setTimeout(()=>{this.zc("gamepack").style.opacity=1,d&&d()},L)},c)},c.dragMoveStart=function(a){if(this.dragging)return this.dragCancel();if(!this.gameParent.canPlay)return;let d=a.clientX&&a||(a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null);this.clicked=!0,this.dragging=!0,this.deltaX=d.clientX-this.left,this.deltaY=d.clientY-this.top,this.lt=this.left,this.tp=this.top,this.tzIdx=this.card.style.zIndex},c.onClick=function(e){this.dragging&&this.dragCancel(),e.preventDefault()},c.dragMove=function(a){if(!this.gameParent.canPlay)return;this.clicked=!1,this.card.style.transition="",this.placeZ("10001");let d=a.clientX&&a||(a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null);if(!d)return this.dragCancel();this.moveTo(new O(d.clientX-this.deltaX,d.clientY-this.deltaY),0)},c.dragMoveEnd=function(a){let d=a.clientX&&a||(a.changedTouches&&a.changedTouches.length?a.changedTouches[0]:null),e=this;if(!d)return this.dragCancel();e.dragging=!1,this.gameParent.canPlay&&(e.placeZ(e.tzIdx),e.card.style.transition="left "+L+"ms ease, top "+L+"ms ease, transform "+L+"ms ease",e.emit("dragend",(function(a,b,c){let n=new O(d.clientX-e.deltaX,d.clientY-e.deltaY,e.width,e.height),m=a.sqrt().inter(n)||e.clicked,o=m&&iscompatible(a.gtp().cardCode,e.cardCode,a.customColor);o&&e.placeZ(1001),e.moveTo(o?a.sqrt():new O(e.lt,e.tp),o?0:e.trotate),o&&m&&b(e,c)})))},c.dragCancel=function(e){let t=this;t.dragging=!1,t.placeZ(t.tzIdx),t.card.style.transition="left "+L+"ms ease, top "+L+"ms ease, transform "+L+"ms ease",t.emit("dragend",(function(a,b,c){t.moveTo(new O(t.lt,t.tp),t.trotate)}))},c.clickEnd=function(a){if(!this.gameParent.canPlay)return;let e=this;e.emit("dragend",(function(a,b,c){let o=iscompatible(a.gtp().cardCode,e.cardCode,a.customColor);o&&e.moveTo(a.sqrt()),o&&b(m,e,c)}))},c.initEvents=function(){this.event=[],this.bc=new O(NaN,NaN,NaN,NaN);let d=this;var dragTarget=d.card.setCapture?d.card:document;return jdg([[["touchstart","mousedown"],d.card,d.dragMoveStart.bind(d)],[["touchmove","mousemove"],dragTarget,function(a){d.dragging&&d.dragMove(a)},{capture:!0,passive:!1}],[["losecapture"],d.card,d.dragCancel.bind(d)],[["click"],document,d.onClick.bind(d)],[["touchend","mouseup"],d.card,d.dragMoveEnd.bind(d),!0]],d.event),this},c.delete=function(){this.canv().remove(),mdg(this.event)},defineCode=function(a,b){a.cardCode=b};var Pile=function(a,b,c,d,e){return this.pile=new Card(a,d,e),this.pile.drawcard(c,b),this.pile.placeZ(10001),this},p;mergeProto(Pile,CallBack),(p=Pile.prototype).gtc=function(){return this.pile},p.listen=function(){this.clickEvent=new Events(["click"],this.pile.canv(),function(a){this.gameParent.canPlay&&(this.gameParent.canPlay=!1,this.emit("create"))}.bind(this))},p.rmlisten=function(){this.clickEvent.removeEvent()},p.delete=function(){this.gtc().delete()};var Pack=function(a,b){this.pack=new Card(a,b),this.pack.placeZ(0)},p;(p=Pack.prototype).gtp=function(){return this.pack},p.sqrt=function(){let b=this.pack;return new O(b.left,b.top,b.width,b.height)},p.flipPack=function(a){let n=Me("CANVAS","card-canvas backface"),m=qe,p=new Qf(n);n.width=uf().width,n.height=uf().height,this.pack.canv().appendChild(n),p.ta(m,0,0),window.setTimeout(()=>{this.pack.canv().style.transform+="rotateY(180deg)",window.setTimeout(()=>{a&&a()},L)},c)},p.update=function(a,b){this.customColor=b||null,this.pack.createCardPatern(codeToCoord(a),hjr(b)).redrawcard()},p.delete=function(){this.gtp().delete()};var hjr=function(a){return function(a){switch(a){case"R":return 1;case"Y":return 2;case"G":return 3;case"B":return 4}}(a)},randomInt=function(mn,mx){return mx||(mx=mn,mn=0),Math.floor(Math.random()*(mx-mn)+mn)},Loader=function(){let a=Me("DIV","box-loader");return a.innerHTML='<div class="loader"><svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="5" stroke-miterlimit="10"/></svg></div>',console.log(this.loader),this.loader=a,this};Loader.prototype.create=function(a){return Md(a,this.loader),this},Loader.prototype.delete=function(){this.loader.remove()};var Socket=function(){this.socket=new WebSocket("ws://"+location.hostname+":8081"),this.deck=null;var ld=new Loader;this.loader=ld.create(Fe(document,"dialog-close")),this.socket.onopen=()=>{console.log("connection opened")},this.socket.onmessage=message=>{try{let msg=this.p(message.data);if(console.log(msg),msg.IS_CONNECTED){this.loader.delete();let d=this.deck=msg.deck,f=this.full=msg.full;this.emit("connection",d,f)}msg.SET_GAME_POO_ID&&(this.gameid=msg.SET_GAME_POO_ID.id),msg.BEGIN&&this.emit("gamebegin",msg.BEGIN.startCard,msg.BEGIN.full,msg.BEGIN.player,msg.BEGIN.turn,msg.BEGIN.canPlay),msg.CURRENT_PLAYER&&this.emit("updatecurrentplayer",msg.CURRENT_PLAYER,this.gameid==msg.CURRENT_PLAYER.id),msg.canPlay&&this.emit("canplay",msg),msg.info&&this.emit("info",msg.info),msg.UPDATE&&(this.gameParent.canPlay=msg.UPDATE.canPlay,this.gameid!==msg.UPDATE.playerid&&this.emit("update",msg.UPDATE)),msg.GAME_FINISHED&&this.emit("gamefinished",msg),msg.USER_DISCONNECTED&&this.emit("userdisconnetion")}catch(error){console.log(error)}},this.socket.onclose=()=>{console.log("receive closed"),ld&&ld.delete(),this.emit("close")}};mergeProto(Socket,CallBack);var s=Socket.prototype;s.j=function(a){return JSON.stringify(a)},s.p=function(a){return JSON.parse(a)},s.begin=function(a){let m=this.j({ready:a,username:this.gameParent.username});this.socket.send(m)},s.sendUpdate=function(a,b,c,d){let m=this.j({UPDATE:{playerid:this.gameid,card:a||null,deckSize:b,...c,newColor:d}});this.socket.send(m)},s.finish=function(a){this.socket.send(this.j({GAME_FINISHED:!0,closeconnection:!0,id:this.gameid,winning:a}))},s.end=function(){this.socket.send(this.j({USER_DISCONNECTION:!0,endconnection:!0})),this.delete()},s.send=function(a){this.socket.send(this.j(a))},s.delete=function(){this.loader&&this.loader.delete(),this.socket.close()};var Game=function(){},g;(g=Game.prototype).start=function(a){this.username=a.length?a:null,this.connectionCreated=!1,this.canPlay=!1,this.gameStarted=!0,this.circleDeck=!0,this.deckContainer=Fe(document,"game-root"),this.overlay=null,this.closeGame(),this.socketBuilder(new Socket),this.connectionTimeout(),this.resizeEvents(),deckToggle(this)},g.connectionTimeout=function(){window.setTimeout(()=>{this.connectionCreated||(this.gameSocket.delete(),this.alert=new AlertPopup("Can't find any opponent","Leave",function(){console.log("stop on timeout"),this.stop()}.bind(this),"Try again",function(){this.socketBuilder(new Socket),this.connectionTimeout()}.bind(this)))},5e3)},g.socketBuilder=function(s){var gameSocket=this.gameSocket=s;console.log(gameSocket,this),kfg(this,gameSocket),gameSocket.on("connection",function(a,b){this.connectionCreated=!0,setTimeout(()=>{this.drawDeck(a,b),this.createOpponentDeck(a.length)},L)}.bind(this)),gameSocket.on("gamebegin",function(a,b,c,d,e){this.overlay=this.overlay||Md(Me("div","display"),Md(Me("div","display-inner"),[Me("h1","display-inner-p"),Me("div","dot-typing")])),Md(document.body,this.overlay),new InfoMessage(this.overlay,"Game is starting!"),this.full=b,this.player=c,this.canPlay=e,this.createPack(a)}.bind(this)),gameSocket.on("canplay",function(a){this.canPlay=a.canPlay,a.isSame&&new InfoMessage(this.overlay,"It's your turn again !")}.bind(this)),gameSocket.on("info",function(a){new InfoMessage(this.overlay,a)}.bind(this)),gameSocket.on("close",function(){console.log("connection closed"),this.connectionCreated&&this.stop()}.bind(this)),gameSocket.on("update",function(a){if(this.canPlay=a.canPlay,this.gameStarted){if(a.fromPile)for(var i=0;i<a.pileChanges.length;i++){let id=this.full.findIndex((function(obj){return obj==a.pileChanges[i]}));this.full.splice(id,1)}a.played&&(this.gamepack.gtp().cardCode=a.card,this.playCardEffects(a.card)),this.updateOpponentDeckAndGamepack(a)}}.bind(this)),gameSocket.on("updatecurrentplayer",function(a,b){!b&&new InfoMessage(this.overlay,"It's  up to "+a.username+" to play."),this.updateCurrentPlayer(a,b,this)}.bind(this)),gameSocket.on("gamefinished",function(a){console.log("gamefinished"),this.onFinish(a)}.bind(this)),gameSocket.on("userdisconnetion",function(){console.log("userdisconnetion");let n=this;if(!n.gameStarted)return;let y=function(){new AlertPopup("Game ended due to opponent disconnection.","Leave",function(){this.reset()}.bind(n))};n.connectionCreated&&n.stop(y)}.bind(this))},g.stop=function(a){if(a&&a(),this.connectionCreated=!1,this.canPlay=!1,this.gameSocket.end(),!a){var ld=new Loader;ld.create(Fe(document,"dialog-close")),window.setTimeout(()=>{ld.delete(),this.reset()},1e3)}},g.end=function(a){console.log("game, end"),this.canPlay=!1,this.gameStarted=!1,this.gameSocket.finish(void 0===a||a)},g.onFinish=function(a){let t=this,y=function(){let u=a.winning?(a.id==t.gameSocket.gameid?"You win the game.":a.player+" win the game.")+" Well played!":"Game is over, you ran out of cards!";new AlertPopup(u,"Leave",(function(){t.reset()}))};u=()=>{t.gamepack.gtp().moveTo(t.pileCoords),window.setTimeout(()=>{t.connectionCreated&&t.stop(y)},L+100)},window.setTimeout(()=>{this.gameStarted=!1,t.gamepack.gtp().placeZ(10001),t.cards.forEach(e=>e.moveTo(t.packCoords,0)),t.oppn.forEach(e=>e.gtc().moveTo(t.pileCoords,0)),window.setTimeout(()=>{t.cards.forEach(e=>e.delete()),t.oppn.forEach(e=>e.delete()),t.gamepack.flipPack(u)},L+100)},this.gameStarted?L:0)},g.reset=function(){this.alert&&this.alert.remove();var cnt=Fe(document,"dialog-container");cnt.classList.remove("-hide-dialog");let t=this,cv=()=>{Mc(cnt,"-hide-dialog"),setTimeout(()=>{console.log("restart on reset"),new UsernamePopup("Choose your username",(function(a){t.start(a)}))},100)};jh(Fe(document,"start-easy-btn"),cv),Fe(document,"close-btn").classList.remove("-show"),Fe(document,"deck-toggle").classList.remove("-show"),document.querySelectorAll(".card, .pile, .gamepack, .opponent, .display, .display, .ad-pn-c").forEach(e=>{e.remove()}),this.oppn=this.cards=[]},g.closeGame=function(){let t=this,v=Fe(document,"close-btn");v.classList.add("-show"),Fe(document,"deck-toggle").classList.add("-show"),v.onclick=()=>{let mess="You are about to leave the game. Game will end, there is no way back.";this.alert=new AlertPopup(mess,"Leave",(function(){console.log("stop on leave"),t.stop()}),"Stay here")}},g.resizeEvents=function(){let t=this;window.onresize=function(){t.placeDeck(),t.placeOpponentDeck(),replacePileAndPackOnResize(t)}},g.drawDeck=function(a,b){this.deck=a,this.full=b,this.cards=[],this.pileCoords=new O(window.innerWidth-200,window.innerHeight/2-T/1.5);let pile=this.pile=new Pile(new O(0,0),qe,this.deckContainer,"pile");pile.gtc().moveTo(this.pileCoords),pile.listen(),kfg(this,pile),this.pileEvent(pile),this.deck&&this.deck.forEach((e,i)=>{this.crtCrad(e)}),this.placeDeck(),setTimeout(()=>{this.gameSocket.begin(!0)},1e3)},g.crtCrad=function(a,b){let ncard=new Card(this.pileCoords),p=this;return ncard.createCardPatern(codeToCoord(a)),defineCode(ncard,a),ncard.drawcard(this.deckContainer).initEvents(),kfg(this,ncard),!b&&ncard.on("dragend",(function(n){n(p.gamepack,p.playCard,p)})),!b&&this.cards.push(ncard),ncard},g.createPack=function(a){this.packCoords=new O(window.innerWidth/2-S/2,window.innerHeight/2-T/1.5),this.gamepack=new Pack(this.pileCoords,"gamepack");var b=this.gamepack;b.gtp().createCardPatern(codeToCoord(a)),defineCode(b.gtp(),a),b.gtp().drawcard(this.deckContainer),window.setTimeout(()=>{b.gtp().moveTo(this.packCoords)},L)},g.updateDeck=function(){},g.placeDeck=function(){let n=window.innerWidth,x=this.circleDeck,o=this.deck.length,p=(n-(S+10)*o)/2,a=o>=10?6:4,lm,y=50*o>=n-200?(n-200)/o:50,q=x?y:p<n/a?(p=n/a,(n-n/a*2)/o):S+10,m=x?(n-(o*y+S-y))/2:p,r=0,s=o%2,g=o-s||1,f=o>4?30:15,e=(S-50)*o>=n-100?45:o>2?o>4?80:60:45,c=[],z=window.innerHeight,b,k=o>10?(o>20?10:20)/o*10:40,d=this.cards.length>1?this.cards.sort((function(a,b){return a.cardCode[1]>=b.cardCode[1]})):this.cards;for(var j=0;j<o;j++){let t=(m+q*j).toFixed(3),l=f/(g/2),u=z-250+(x?-(j>=g/2?s>0?l*(g-j):l*(o-j-1):l*j):0),v=d[j],h=o>1?-e/2*(j<g/2?g-j-g/2:(s>0?0:-1)-(j-g/2))/(g/2):0;c.push([v,t,u,j+1,h])}for(var i=o-1;i>=0;i--){let d=c[i];d[0].placeZ(d[3])}var w=window.setInterval(()=>{if(r===o)return clearInterval(w);let d=c[r];d[0].moveTo(new O(d[1],d[2]),x?d[4]:0),d[0].trotate=x?d[4]:0,r++},k)},g.playCard=function(b,c,p){let n,m,id=c.cards.findIndex((function(obj){return obj.id==b.id}));window.setTimeout(()=>{c.gamepack.update(b.cardCode),b.delete(),0===c.cards.length&&c.end()},600),c.gamepack.gtp().cardCode=b.cardCode,-1!==id&&(n=c.cards.splice(id,1),m=c.deck.splice(id,1)),window.setTimeout(()=>{c.placeDeck()},50),!p&&c.sendGameUpdate(b.cardCode,{played:!0,fromPile:!1,pileChanges:[],changedColor:"W"==b.cardCode[0]&&"Z"==b.cardCode[1],isDrawCards:!1})},g.pileEvent=function(a){var n=this;a.on("create",(function(){if(!n.full.length)return n.end(!1);let b=[],d=n.full.shift(),l=!1;if(b.push(d),iscompatible(n.gamepack.gtp().cardCode,d,n.gamepack.customColor)){l=!0;let j=n.crtCrad(d,!0);window.setTimeout(()=>{j.moveTo(n.gamepack.sqrt()),n.playCard(j,n,!0)},50)}else n.deck.push(d),n.crtCrad(d),window.setTimeout(()=>{n.placeDeck()},50);n.sendGameUpdate(l?d:null,{played:l,fromPile:!0,pileChanges:b,changedColor:l&&"W"==d[0]&&"Z"==d[1],isDrawCards:!1})}))},g.sendGameUpdate=async function(a,b){this.canPlay=!1;let newColor=null;this.cards.length&&a&&"Z"==a[1]&&("W"==a[0]||"X"==a[0])&&(newColor=await this.chooseNewColor()),new InfoMessage(this.overlay,"Waiting for next player..."),newColor&&this.gamepack.update(this.gamepack.gtp().cardCode,newColor),window.setTimeout(()=>{this.gameSocket.sendUpdate(a,this.deck.length,b,newColor)},newColor?700:0)},g.createOpponentDeck=function(a){this.oppn=this.oppn||[];for(var i=0;i<(a||7);i++){let oc=new Pile(new O(0,0),qe,this.deckContainer,"opponent",{width:Bf()?S/1.65:60,height:Bf()?T/1.65:90});oc.gtc().placeZ(0).moveTo(this.pileCoords),this.oppn.push(oc)}this.placeOpponentDeck()},g.updateOpponentDeckAndGamepack=function(a){if(a.fromPile&&a.played){let oc=new Card(this.pileCoords,"card rinverted");oc.drawcard(this.deckContainer,qe);let u=()=>{this.gamepack.update(a.card,a.newColor),oc.delete()};window.setTimeout(()=>{oc.placeZ(1).moveTo(this.packCoords).flip(a.card,a.newColor,550,u)},10)}if(a.deckSize!=this.oppn.length){if(a.deckSize>this.oppn.length){for(var i=0;i<a.deckSize;i++)if(!this.oppn[i]){let oc=new Pile(new O(0,0),qe,this.deckContainer,"opponent",{width:Bf()?S/1.65:60,height:Bf()?T/1.65:90});oc.gtc().placeZ(0).moveTo(this.pileCoords),this.oppn.push(oc)}}else if(a.deckSize<this.oppn.length)for(var i=0;i<=this.oppn.length-a.deckSize;i++){let del=this.oppn[a.deckSize];this.oppn.splice(a.deckSize,1);let u=()=>{this.gamepack.update(a.card,a.newColor),del.delete()};del.gtc().resize(S,T).placeZ(1).moveTo(this.packCoords,0).flip(a.card,a.newColor,550,u)}this.placeOpponentDeck()}},g.placeOpponentDeck=function(){let n=window.innerWidth,o=this.oppn.length,p=Bf()?n/3:200,lm,y=50*o>=p?p/o:50,q=y,m=(n-(o*y+S-y))/2,r=0,s=o%2,g=o-s||1,f=50,e=o>2?80:45,c=[],b,k=o>10?(o>20?10:20)/o*10:40,d=this.oppn;console.log(Bf(),p);for(var j=0;j<o;j++){let t=(m+q*j).toFixed(3),l=f/(g/2),u=20+(j>=g/2?s>0?j==g/2+s-1?l*(g-j-1):l*(g-j):l*(o-j-1):l*j),v=d[j],h=o>1?e/2*(j<g/2?g-j-g/2:(s>0?0:-1)-(j-g/2))/(g/2):0;c.unshift([v,t,u,j+1,h])}for(var i=o-1;i>=0;i--){let d=c[i];d[0].gtc().placeZ(d[3])}var w=window.setInterval(()=>{if(r==o)return clearInterval(w);let d=c[o-r-1];d[0].gtc().moveTo(new O(d[1],d[2]),d[4]+180),r++},k)},g.playCardEffects=function(a){window.setTimeout(()=>{"V"==a[1]&&this.addCardsToDeck(2),"Z"==a[1]&&"X"==a[0]&&this.addCardsToDeck(4)},L+150)},g.chooseNewColor=async function(){try{return await new Promise((resolve,reject)=>{window.setTimeout(()=>{new PiePopup((function(a){resolve(a)}))},500)})}catch(error){console.log(error)}},g.addCardsToDeck=function(a){let b=[];for(var i=0;i<a;i++){let d=this.full.shift();b.push(d),this.deck.push(d),this.crtCrad(d)}window.setTimeout(()=>{this.placeDeck()},50),this.sendGameUpdate(null,{played:!1,fromPile:!0,pileChanges:b,changedColor:!1,isDrawCards:!0})},g.updateCurrentPlayer=function(a,b,c){Fa(c.overlay,"display-inner-p").innerText=b?"It's your turn":a.username+" is playing"};var iscompatible=function(a,b,c){return a[0]==b[0]||a[1]==b[1]||"Z"==a[1]&&c==b[0]||"Z"==b[1]},codeToCoord=function(a){function e(h){switch(h.toUpperCase()){case"R":return 0;case"Y":return 1;case"G":return 2;case"B":return 3;case"D":return 10;case"P":return 11;case"V":return 12;case"W":return 4;case"X":return 5;case"Z":return 0;default:return null}}let b=e(a.slice(0,1)),d=e(a.slice(1)),c;return{x:null!==d?d:parseInt(a.slice(1)),y:b}},kfg=function(a,b){b.gameParent=a},rtcp=function(a,b){a.gtc().canv().style.transform="rotate("+b+"deg)"},btcp=function(a,b){a.canv().style.transform="rotate("+b+"deg)"},deckToggle=function(a){Fe(document,"deck-toggle").onclick=function(){a.circleDeck=!a.circleDeck,a.cards.forEach(e=>{e.moveTo(a.pileCoords,0)}),setTimeout(()=>a.placeDeck(),L)}},replacePileAndPackOnResize=function(a){a.pileCoords=new O(window.innerWidth-200,window.innerHeight/2-T/1.5),a.pile.gtc().moveTo(a.pileCoords),a.packCoords=new O(window.innerWidth/2-S/2,window.innerHeight/2-T/1.5),a.gamepack.gtp().moveTo(a.packCoords)},jh=function(a,b){let o=!1;a.onclick=()=>{o||(o=!0,b())},window.addEventListener("keyup",(function(key){13!==key.keyCode||o||(o=!0,b())}))},PiePopup=function(a){this.callBack=a;let m=Me("div","color-pie ad-status-panel"),n=this.n=Md(Me("div","pie-container ad-pn-c"),m);this.colors=["#ff5555","#ffaa00","#55aa55","#5555ff"],this.canSelect=!1,this.generate(m),Md(document.body,n)},p;(p=PiePopup.prototype).generate=function(a){let ur="http://www.w3.org/2000/svg",n=Ms(Me("svg"),["class","xmlns","viewBox"],["pie",ur,"0 0 180 180"]),r=Ms(Me("text"),["y","dx","dominant-baseline","text-anchor"],["-30","50%","middle","middle"]),k=["R","Y","G","B"],t=this,h=[];r.textContent="Choose your new color",Md(n,r);for(var i=0;i<4;i++){let m=Me("path"),o=0==i||2==i?"90":1==i?"180":"0",p=1==i||3==i?"90":2==i?"180":"0",q=1==i||3==i?"90":0==i?"180":"0",c=t.colors[i],j=k[i],d;Ms(m,["id","fill","d"],[i,c,"M"+o+","+p+" A90,90 0 0 1 "+q+","+o+" L90,90 A0,0 0 0 0 90,90 Z"]),new Events(["click"],m,(function(){t.canSelect&&(t.canSelect=!1,t.callBack(j),t.delete())})),h.push(m),Md(n,m)}Mc(t.n,"adding"),Md(a,n),setTimeout(()=>{h.forEach(e=>{e.style.transform="scale(1)"}),setTimeout(()=>{Mr(t.n,"adding"),t.canSelect=!0},100)},1e3)},p.delete=function(){Mc(this.n,"remove"),setTimeout(()=>{this.n.remove()},1e3)};var AlertPopup=function(t,a,b,c,d){Fa(document,"ad-pn-c")&&Fa(document,"ad-pn-c").remove();let l=Me("div","ad-pn-c"),u,r=[];if(Md(document.body,l),t=t.replaceAll(/\n/g,"<br/>"),c){let n=Ms(Md(Me("div","ad-err-close ad-demi ad-demi-sup left"),Me("p","",{in:a})),"id","ad-err-reset-btn"),m=Ms(Md(Me("div","ad-err-close ad-demi right"),Me("p","",{in:c})),"id","ad-err-close-btn");u=Md(Me("div","ad-btn"),[n,m]),n.addEventListener("click",b),r.push(n,m),d&&m.addEventListener("click",d)}else u=Md(Me("div","ad-btn"),Ms(Md(Me("div","ad-err-close"),Me("p","",{in:a||"Close"})),"id","ad-err-close-btn")),b&&u.addEventListener("click",b),r.push(u);return Md(l,Md(Me("div","ad-panel grow-anim"),[Md(Me("div","ad-err"),Me("p","",{in:t})),u])),r.map(e=>e.addEventListener("click",(function(){l.remove()}))),l},UsernamePopup=function(t,a){let o=!1,p=Ms(Md(Me("div","ad-err-close"),Me("p","",{in:"Save"})),"id","ad-err-close-btn"),m=Me("label","f0n8F"),n=Ms(Me("input","_2hvTZ pexuQ zyHYP"),["autocomplete","autocorrect","autocapitalize","autofocus","required","maxlength","type","aria-required","name","id","value"],["off","off","off","","","15","text","true","username","on-user-input",""]),j=Md(Me("div","ttpo"),Md(m,[Me("span","_9nyy2",{in:"Username"}),n])),l=Md(Me("div","ad-pn-c"),Md(Me("div","ad-panel grow-anim"),[Md(Me("div","ad-err"),[Me("p","",{style:"min-height: auto;",in:t}),j]),Md(Me("div","ad-btn"),p)])),y=function(a){console.log(a,n.value),n.value.length?m.classList.add("FATdn"):m.classList.remove("FATdn")};m.onkeyup=y,m.onkeypress=y,Md(document.body,l);var pp=()=>{let str=n.value;/\s/.test(str)?m.classList.add("wrong-enter-r"):(o=!0,a(str),l.remove())};return p.addEventListener("click",pp),window.addEventListener("keyup",(function(key){13!==key.keyCode||o||pp()})),l},InfoMessage=function(a,b){let n=Me("h1","display-inner-p"),m=this.message=Md(Me("div","display-inner txt-only"),n);n.innerText=b,Md(a,m),window.setTimeout(()=>{this.delete()},3e3)},i=InfoMessage.prototype;i.delete=function(){this.message.remove()};var Hh=function(){var started=null;me.ja().preload(0,(function(){}))}(function(){var started=null,cnt=Fe(document,"dialog-container");Mr(cnt,"-hide-dialog");let cv=()=>{started||(started=new Game,Mc(cnt,"-hide-dialog"),setTimeout(()=>{console.log("start"),new UsernamePopup("Choose your username",(function(a){started.start(a)}))},100))};jh(Fe(document,"start-easy-btn"),cv)}());